var DEBUGGING=true;(function(j){var i,o=j,d=o.document,b=o.$,r=new Date().getTime(),n="",p=null,l={},k,q,h,e,c,g,m,a,f;h=function(){};k=function(){b("html, body").stop().animate({scrollTop:"0px"},600)};g=function(s){return new g.prototype.rig(s)};g.prototype=(function(){var x={constructor:g,version:"1.0",ready:false,url:false,callback:false},w={},v={close:h,update:h},s=function(){return{csrf_token:n,token:this.token,extras:this.extras,raw:(this.raw===true)?"raw":false}},t=function(y){if(y.new_flag&&y.new_flag=="dead"){this.close();this.ready=false;this.events.close();e.l("Socket #"+this.uid+": was terminated on the server end");return false}else{if(!y.success){e.l("Socket #"+this.uid+": the socket was unsuccessful","err");this.ready=false;return false}}if(parseInt(y.code,10)==1){e.l("Socket #"+this.uid+": package received");this.events.update(y["package"]||{})}else{e.l("Socket #"+this.uid+": no package received -> restarting")}},u=function(y){if(y!==undefined&&e.type(y)==="object"){t.call(this,y)}if(this.looping===true&&this.ready===true){w[this.uid]=b.post(this.url,s.call(this),_.bind(u,this),"json")}};x.rig=function(y){if(!y||y===undefined||e.type(y)!=="object"){return false}this.url=y.url||false;this.events=b.extend({},v,y.events);this.token=y.token;this.extras=y.extras||{};this.uid=e.uid();this.raw=false;if(this.url===false){return false}this.ready=true};x.force=function(){var y=(function(z){return(function(A){t.call(z,A)})})(this);e.l("forcing socket #"+this.uid);this.raw=true;b.post(this.url,s.call(this),y,"json");this.raw=false};x.open=function(){if(!this.ready){return false}e.l("Socket #"+this.uid+": opening up");this.looping=true;u.call(this)};x.close=function(){this.looping=false;this.ready=false;if(w[this.uid]){w[this.uid].abort()}};return x})();g.prototype.rig.prototype=g.prototype;f=function(s){return new f.ns.rig(s)};f.ns=f.prototype=(function(){var s={version:"1.0",constructor:f};s.rig=function(t){if(!t||t==undefined){return false}this.username=t.username||"N/A";this.wins=(e.pint(t.wins))?e.pint(t.wins):0;this.losses=(e.pint(t.losses))?e.pint(t.losses):0;this.active=t.active||false;if(this.active!==false){p=this}this.token=t.token||false};return s})();f.ns.rig.prototype=f.prototype;m=a=function(s){return new a.ns.rig(s)};a.ns=a.prototype=(function(){var u={constructor:a,version:"1.0"},t={update:h},s=function(v){var w={msg:v.message||false,chat_token:this.chat_token,user_token:this.user_token,csrf_token:n};return w};u.receive=function(v){if(!v||!v.length){return false}this.messages=v;this.events.update(this.messages)};u.start=function(){if(!this.ready){e.l("chat room not ready to make calls","err");return false}this.events.update(this.messages);this.socket.open()};u.sendCheck=function(v){if(!v.success){e.l("something when wrong in chatroom: "+this.uid,"err");this.socket.close();this.ready=false}else{this.input.$inputs.val("")}};u.send=function(v){if(!this.ready){e.l("chat room not ready to send messages","err");return false}b.post("/chat/send",s.call(this,v),_.bind(this.sendCheck,this))};u.registerForm=function(v){var w;if(e.type(v)=="string"){w=new IV({form:d.getElementById(v),callback:_.bind(this.send,this)})}else{if(e.type(v)=="object"){w=new IV({form:v.form||undefined,callback:_.bind(this.send,this)})}else{w=new IV({callback:h})}}this.input=w;return w};u.rig=function(v){if(!v||v==undefined){return false}this.ready=false;this.name=v.name||"N/A";this.uid=e.uid();this.events=b.extend({},t,v.events);this.chat_token=v.chat_token||false;this.user_token=v.user_token||false;this.messages=v.messages||[];if(this.chat_token===false||this.user_token===false){return false}this.socket=g({url:"/chat/socket",events:{update:_.bind(this.receive,this)},token:this.chat_token,extras:{chat_token:this.chat_token,user_token:this.user_token}});l[this.uid]=this;this.ready=true};return u})();a.ns.rig.prototype=a.prototype;c=e={template:(function(){var u,s,t,v={};t=function(){if($(this).length<1){return false}var y=$(this),w=y.data("name")||e.uid(),x=y.html();v[w]=_.template(x)};s=function(){e.l("loading all templates");b('script[type="text/template"]').each(t)};u=function(w,x){if(!v.hasOwnProperty(w)){return false}return v[w](x)};u.load=t;b(d).ready(s);return u})(),uid:(function(){var t=0,s=function(){return Math.floor(Math.random()*100000).toString(36).substring(0,5)};return function(){return s()+(++t)}})(),tsm:function(s,t){return"translate("+s+","+t+")"},pint:function(s){return parseInt(s,10)},type:(function(){var s=Object.prototype.toString,u={"[object Array]":"array","[object Function]":"function","[object Object]":"object","[object Number]":"number","[object String]":"string","[object Boolean]":"boolean"},t=function(v){var w=s.call(v);return u[w]||w};return t})(),Entry:(function(){var u,t=[],s=false,v;v=function(){if(s){return false}for(var w=0;w<t.length;w++){t[w](p,n)}s=true};u=function(w){if(e.type(w)!=="function"){return false}t.push(w);if(s){w(p)}return true};b(d).ready(v);return u})(),l:(function(v){if(v==false||!DEBUGGING){return h}var t=function(w){return o.console.log("["+w+"]")},s=function(w){return o.console.dir(w)},u=function(w){return o.console.error("!! "+w)};return function(x,w){if(!w){return t(x)}switch(w){case"log":t(x);break;case"dir":s(x);break;case"err":u(x);break;default:t(x);break}return}})(!!o.console),};q=(function(){var v,z,u,t,w,s,y,A=false,x;w=function(B){if(B.keyCode!==27){return}t.call(this);return B.preventDefault&&B.preventDefault()};u=function(){if(!A){return}this.addClass("open");b(d).on("keydown",_.bind(w,this))};t=function(){if(!A){return}this.removeClass("open");b(d).off("keydown",_.bind(w,this))};z=function(){if(!A){return}return this.hasClass("open")?t.call(this):u.call(this)};v=function(B){s=b(B);if(s.length<1){return false}y=(function(C){return function(){z.call(C)}})(s);s.on("click","button.toggle",y);A=true};x={open:u,close:t,init:v,toggle:z};return x})();i=function(){if(d.getElementById("authd-menu")!==null){q.init("#authd-menu")}if(d.getElementById("chatist-menu")!==null){q.init("#chatist-menu")}if(d.getElementById("to-top")!==null){b("#to-top").click(k)}if(d.getElementById(String(r).substring(0,5))!==null){n=b("#"+String(r).substring(0,5)).find('input[type="hidden"]').val()}};window.U=window.Utils=e;window.C=window.Chat=m;window.User=f;window.Socket=g;window.Entry=e.Entry;Entry(i)})(window);