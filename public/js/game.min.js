(function(l){var d,c,n,h={},e,b,f,g,k,m={},i=1,o=function(){e=document.getElementById("render-zone");f=document.getElementById("chat-zone");var s=d3.select(document.body).append("svg"),r=s.append("defs"),q=r.append("polygon"),p=r.append("linearGradient");p.append("stop").attr(k.msgboxgradstops[0]);p.append("stop").attr(k.msgboxgradstops[1]);q.attr(k.hexo);s.attr(k.helpersvg);p.attr(k.msgboxgrad)},a=function(s,q){var t=[];q.token=s.token||(t.push("no key")&&false);q.uid=U.uid();h[q.uid]=q;q.challenger=User(s.challenger);q.visitor=(s.visitor)?User(s.visitor):false;if(q.visitor&&q.visitor.active&&!q.challenger.active){i=2;U.l("you are the visitor of this game")}else{if(!q.visitor||(!q.visitor.active&&q.challenger.active)){i=1;U.l("you are the challenger of this game")}}q.state=s.state;q.tiles=s.tiles;q.turn=s.turn||0;var p={events:{update:_.bind(q.updateChat,q)}},r=$.extend({},p,s.chatroom);q.chatroom=Chat(r);q.socket=Socket({url:k.gamesocket.url,token:q.token,events:{update:_.bind(q.update,q),close:_.bind(q.end,q)}});if(t.length>0){U.l("was unable to initialize the game","err");q.errored=true}return t.length>0},j=function(q){U.l("Document is ready, rendering game");var u=q.dom,p=d3.select(e).append("svg"),t={},r,s;for(s=0;s<k.layers.length;s++){r=k.layers[s];t[r]=p.append("g");t[r].attr({"data-name":r,transform:U.tsm(0,0)});if(m[r]){m[r].call(q,t[r])}}b=q.chatroom.registerForm({form:document.getElementById("chat-input"),});q.socket.open();q.chatroom.start();p.attr(k.dimensions);u.svg=p;u.layers=t};m={game:function(z){U.l("rendering game layer");var D=100,C=130,G=0,u=[3,4,5,6,5,4,3],E=0,s=-1,A,w,B=0,r=0,p=[],q;for(var v in this.tiles){if(!this.tiles.hasOwnProperty(v)){continue}q=this.tiles[v];v=U.pint(v);if(v==19){E++}if(E>u[G]){G++;E=0;C+=s*30}if(G>=Math.floor(u.length*0.5)){s=1}A=D+(G*54);w=C+(E*60);E++;var F=n(q,this);p.push(F.render(z,A,w))}this.tiles=p},ui:function(p){var r=p.append("g").attr(k.msgbox),s=r.append("g").attr("transform","translate(0,0)"),q=s.append("rect").attr(k.msgrect),t=s.append("text").attr(k.hexotext);this.dom.msgbox={container:s,rect:q,text:t}}};g=k={chattemplate:'         <dl class="cf message">             <dt class="f">{{ user }}</dt>             <dd class="f">{{ text }}</dd>         </dl>     ',dimensions:{width:"540px",height:"440px"},msgbox:{transform:"translate(270,-100)","data-name":"msgbox"},msgrect:{width:320,height:120,fill:"url(#msgboxgrad)",ry:4,rx:4,x:-160,y:-60},msgtxt:{},msgboxgrad:{id:"msgboxgrad",gradientUnit:"userSpaceOnUse",x1:"100%",y1:"100%",x2:"100%",y2:"0%"},msgboxgradstops:[{"stop-color":"#807a69",offset:"1"},{"stop-color":"#726D5D",offset:"0"}],gamesocket:{url:"/game/socket"},helpersvg:{width:"0px",height:"0px",id:"svghelper"},layers:["game","ui"],hexo:{points:"16.326,28.101 -16.174,28.188 -32.5,0.086 -16.326,-28.101 16.174,-28.188 32.5,-0.086",id:"hexo"},gamehexo:{"xlink:href":"#hexo",fill:"#333",style:"cursor:pointer"},hexotext:{"text-anchor":"middle",fill:"#eee","font-size":"12px",x:0,y:5,style:"font-family:'Open Sans',sans-serif;font-weight:400;"}};n=function(p,q){return new n.ns.rig(p,q)};n.ns=n.prototype=(function(){var s={version:"1.0",constructor:n,dom:{},errored:false},q,r,p;r=function(){if(this.game.turn!==i){this.game.notify("its not your turn!");return false}};q=function(){this.dom.tile.transition().duration(620).ease("elastic").attr("transform","scale(1.08)")};p=function(){this.dom.tile.transition().duration(620).ease("elastic").attr("transform","scale(1.0)")};s.rig=function(u,t){if(!t){this.errored=true;return false}this.game=t;this.uid=U.uid();this.state=u.state||0;this.value=u.value||0};s.render=function(u,t,y){var w=u.append("g").attr("data-uid",this.uid),v=w.append("use"),x=w.append("text");x.attr(k.hexotext).text(this.value);w.attr("transform",U.tsm(t,y));v.attr(k.gamehexo);w.on("mouseover",_.bind(q,this)).on("mouseout",_.bind(p,this)).on("click",_.bind(r,this));this.dom={group:w,tile:v};return this};return s})();n.ns.rig.prototype=n.prototype;c=function(p){return new c.ns.rig(p)};c.ns=c.prototype=(function(){var p={version:"1.0",constructor:c,errored:false,dom:{}};p.rig=function(q){if(q===undefined||!q){this.errored=true;return false}U.l("Preparing game for document.ready");return a(q,this)};p.end=function(){U.l("game over");this.socket.close()};p.update=function(s){if(!s||s.state===null){this.end()}if(s.state===1&&this.state===0){this.state=1;this.socket.force()}if(this.visitor===false&&s.visitor!=false){U.l("The visitor has joined");var r=User(s.visitor),q=$("#visitor-info");q.find("h1.name").text(r.username);q.find("dl.wins dd").text(r.wins);q.find("dl.losses dd").text(r.losses);this.visitor=r}this.draw()};p.draw=function(){};p.notify=function(q){this.dom.msgbox.container.transition().duration(800).attr("transform",U.tsm(0,300))};p.updateChat=function(t){U.l("updating game chat");$(f).html("");for(var r=0;r<t.length;r++){var v=t[r],s=v.user||"",u=v.message||"",q=k.chattemplate.replace(/{{ user }}/g,s).replace(/{{ text }}/g,u);f.innerHTML+=q}$(f).scrollTop($(f).height()+1000)};return p})();c.ns.rig.prototype=c.prototype;d=function(){o();for(var p in h){j(h[p])}};l.Game=c;Entry(d)})(window);