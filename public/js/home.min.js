(function(){var c,d=hexo.Utils,a,j,b,h,i,e,g,k,f;k=function(n){var l={room_id:n.id,room_count:n.count,room_name:n.name},m=d.template("chatroom-list-item",l);document.getElementById("open-chat-listing").innerHTML+=m};g=function(l){var m=l.room_name;i();return hexo.Chat.makeRoom(m,k)};i=function(l){if(l&&l.keyCode&&l.keyCode!==27){return}$("#new-room-factory").stop().animate({bottom:"-400px"},d.anTime,d.anEase,function(){});$(document).off("keydown",i)};h=function(){$("#new-room-factory").stop().animate({bottom:"0px"},d.anTime,d.anEase,function(){});$(document).on("keydown",i)};e=function(){var l=$(this),m=l.data("id");hexo.Chat.joinRoom(m)};f=(function(){var r={},q={container:"#online-list",roomcontainer:"#open-chat-listing",socket_url:"/socket/online",template:"online-user",roomtemplate:"chatroom-list-item-template"},n,p,l,o,m;m=function(s){if(!s||!s.success){return false}document.location="/game/play"};o=function(){var s=$(this),t=s.data("user");a.challengeUser(t,m)};r.update=function(t){if(d.type(t)!=="object"){return false}p.html("");hexo.Geo.clearMarkers();var s="";_.each(t.users,function(u){s+=d.template(q.template,u);hexo.Geo.addMarker(u.location,u.username)});p.html(s);l.html("");s="";_.each(t.rooms,function(u){var v={room_id:u.id,room_count:u.count,room_name:u.name};s+=d.template(q.roomtemplate,v)});l.html(s)};r.init=function(s){d.l("setting up online user list");$.extend(q,s);p=$(q.container);l=$(q.roomcontainer);p.on("click","button.challenge",o);l.parent().parent().on("click","button.add-new",h);l.on("click","button.quick-join",e);n=hexo.Socket({url:q.socket_url,token:a.token,events:{update:_.bind(r.update,r)}});n.open()};return r})();c=function(l,m){d.l("setting up homepage");a=l;j=m;f.init();b=new IV({form:document.getElementById("new-room-form"),callback:g});hexo.Chat.openRoom(hexo.Chat.getUID("General Chat"))};hexo.Entry(c)})();